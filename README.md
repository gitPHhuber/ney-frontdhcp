# DHCP Monitoring Frontend

## Назначение проекта
Веб-клиент моделирует рабочие места сетевых и эксплуатационных команд, которые управляют DHCP-инфраструктурой и смежными сервисами. Интерфейс собирает в одном месте мониторинг аренды адресов, контроль конфигурации, управление доступом и интеграции с производственными системами. Приложение пригодно как демонстрационный стенд, прототип для пилотных внедрений или песочница для UX-исследований без подключения к боевым сервисам.

## Основные возможности интерфейса
### Мониторинг и контроль DHCP
- **Панель мониторинга** отображает ключевые показатели (количество активных арен, инциденты, метки) и свежие логи сервера с автоматическим форматированием согласно выбранной локали. 【F:src/pages/DashboardPage.tsx†L19-L119】
- **Управление DHCP-сервером** даёт обзор состояния, конфигурации и журналов, а также позволяет запускать, останавливать и перезапускать сервис с учётом прав пользователя. 【F:src/pages/DhcpServerPage.tsx†L13-L129】【F:src/context/DhcpServerContext.tsx†L17-L113】
- **Страница динамических арен** поддерживает фильтрацию по статусу, поиск по IP и имени хоста, пагинацию, инлайн-обновление приоритетов и периодический опрос API. 【F:src/pages/LeasesPage.tsx†L9-L159】【F:src/pages/LeasesPage.tsx†L199-L274】
- **Статические назначения** управляются через таблицу с модальным созданием и подтверждением удаления, причём права на действия проверяются через RBAC. 【F:src/pages/StaticLeasesPage.tsx†L7-L120】

### Управление доступом и аудит
- Центр контроля доступа объединяет каталог ролей, матрицу разрешений, запросы на повышение прав и журнал аудита с быстрыми решениями заявок. 【F:src/pages/access-control/AccessControlPage.tsx†L5-L206】
- Аутентификация, авторизация и обход входа для разработки реализованы в `AuthContext`, который хранит состояние в `localStorage` и подхватывает флаг `VITE_BYPASS_AUTH`. 【F:src/context/AuthContext.tsx†L21-L129】

### Инвентарь, топология и отчёты
- **Инвентаризация** реализует виртуализированную таблицу TanStack с черновым редактированием через React Hook Form и Zod. 【F:src/features/inventory/InventoryTable.tsx†L1-L118】
- **Сетевая топология** рендерится на Cytoscape с раскладкой `cose` и индикацией статусов узлов. 【F:src/features/topology/TopologyCanvas.tsx†L1-L60】
- **Конструктор отчётов** позволяет собирать макеты drag-and-drop-подходом, выбирать пресеты и экспортные форматы, а также валидирует данные. 【F:src/features/reports/ReportsBuilderCanvas.tsx†L1-L153】
- Дополнительные домены (alerts, incidents, executive dashboard, MES, ERP) представлены плейсхолдерами `PagePlaceholder`, готовыми к наполнению данными и действиями. 【F:src/shared/ui/PagePlaceholder.tsx†L1-L30】

### Автоматизация и поддерживающие процессы
- Каталог плейбуков отображает риск каждого сценария, меню запуска и подсказки по готовности к аудиту. 【F:src/features/automation/PlaybookList.tsx†L1-L61】

- Конструктор плейбуков включает форму целей, выбор устройств, хранение токена Ollama в браузере и чат с локальной моделью для подготовки сценариев. 【F:src/features/automation/PlaybookBuilder.tsx†L1-L293】

- Страница «Navigation health check» прогоняет ленивые маршруты через `ErrorBoundary`, фиксируя успешные и проблемные участки. 【F:src/pages/navigation-check/NavigationCheckPage.tsx†L5-L146】
- Скрипт `scripts/capture-diagnostics.mjs` собирает диагностические логи и сетевые ошибки по ключевым маршрутам и сохраняет отчёт в `docs/diagnostics`. 【F:scripts/capture-diagnostics.mjs†L1-L56】

### UX-инструменты и продуктивность
- Командная палитра объединяет навигацию, фильтрует маршруты по правам и поддерживает работу с горячими клавишами. 【F:src/widgets/command-palette/CommandPalette.tsx†L15-L138】
- Горячие клавиши регистрируются через `HotkeysProvider`, который хранит метаданные для отображения комбинаций. 【F:src/shared/hotkeys/HotkeysProvider.tsx†L1-L101】
- Центр уведомлений агрегирует некритичные события из React Query, поддерживает локализацию и подсчёт непрочитанных сообщений. 【F:src/widgets/notification-center/NotificationCenter.tsx†L1-L134】
- Интерактивный гид (`GuidedTour`) помогает онбордингу пользователей, закрывает фокус внутри модального окна и работает с клавиатурой. 【F:src/widgets/guided-tour/GuidedTour.tsx†L1-L132】
- Toaster на базе Sonner отображает критические события на уровне приложения. 【F:src/app/providers.tsx†L27-L43】
- Глобальные модальные окна теперь имеют скролл по оверлею и ограничение высоты содержимого, что улучшает доступность форм. 【F:src/styles/components/_modal.css†L1-L81】

## Технологический стек
- **React 18 + TypeScript** с маршрутизацией через React Router и ленивыми загрузками. 【F:src/main.tsx†L1-L31】【F:src/app/AppShell.tsx†L1-L120】
- **Vite** используется для сборки, поддерживая hot reload и dev-сервер. 【F:package.json†L5-L32】
- **@tanstack/react-query** управляет кэшированием запросов и состояниями загрузки. 【F:src/app/providers.tsx†L16-L34】
- **React Hook Form + Zod** обеспечивают валидацию и работу с формами в таблицах и мастерах. 【F:src/features/inventory/InventoryTable.tsx†L1-L88】【F:src/features/reports/ReportsBuilderCanvas.tsx†L1-L81】
- **Cytoscape** визуализирует топологию сети. 【F:src/features/topology/TopologyCanvas.tsx†L1-L42】
- **Framer Motion** отвечает за плавные появления плейсхолдеров страниц. 【F:src/shared/ui/PagePlaceholder.tsx†L1-L24】
- **Sonner** используется как тостер уведомлений. 【F:src/shared/ui/Toaster.tsx†L1-L27】
- **Tailwind CSS и каскадные модули** комбинируются в `src/styles/main.css` для токенов дизайна, layout и компонентов. 【F:src/styles/main.css†L1-L69】

## Архитектура и провайдеры
Провайдеры приложения выстраиваются в строгом порядке: ErrorBoundary → I18next → React Query → Hotkeys → Theme → Auth → DHCP. Это гарантирует доступность контекстов для дочерних компонентов и единую точку отображения тостов. 【F:src/app/providers.tsx†L13-L43】

RBAC, фиче-флаги и конфигурация навигации собраны в отдельных модулях:
- `featureFlags` позволяет включать или выключать доменные разделы без правок кода. 【F:src/shared/config/featureFlags.ts†L1-L25】
- `app/navigation` описывает боковое меню и используется командной палитрой и проверкой навигации. 【F:src/app/navigation.ts†L1-L120】

## Работа с данными и мок-API
Все операции происходят через `src/services/api.ts`, который имитирует серверную сторону, хранит данные в `localStorage` и генерирует события журнала. Состояния DHCP, роли, пользователи и аренды синхронизируются с UI и обновляются оптимистично. 【F:src/services/api.ts†L1-L160】【F:src/services/api.ts†L305-L399】

Переключение на реальный backend возможно заменой методов API и отключением `VITE_BYPASS_AUTH`, после чего интерфейс запросит реальные учётные данные.

## Быстрый старт
```bash
npm install
VITE_BYPASS_AUTH=1 npm run dev
```

Флаг `VITE_BYPASS_AUTH=1` включает автологин под пользователем `dev-admin` с полным набором разрешений, что ускоряет исследование интерфейса в режиме разработки. 【F:src/context/AuthContext.tsx†L55-L92】

## Переменные окружения
- `VITE_VEGMAN_PASSPORT_TEMPLATE_URL` — абсолютный или относительный URL до .xlsx-шаблона паспорта изделия Vegman. Файл хранится вне репозитория и должен быть доступен из браузера во время экспорта.

## Доступные скрипты npm
- `npm run dev` — запуск Vite в режиме разработки.
- `npm run build` — сборка оптимизированной версии приложения.
- `npm run preview` — предпросмотр собранного бандла.
- `npm run lint` — проверка ESLint.
- `npm run test` — юнит-тесты на Vitest.
- `npm run typecheck` — изолированная проверка типизации.
- `npm run e2e` — Playwright-тесты.

## Структура проекта
```
src/
├── app/                     # Каркас приложения: shell, провайдеры, роутер
├── pages/                   # Отдельные маршруты (DHCP, отчёты, контроль доступа, диагностика)
├── features/                # Доменные модули (инвентарь, топология, конструктор отчётов, автоматизация)
├── widgets/                 # Командная палитра, уведомления, гид
├── components/              # Универсальные UI-компоненты и формы
├── shared/                  # Хуки, конфигурации, UI-примитивы, утилиты
├── services/                # API-адаптер с мок-данными и локальным хранилищем
└── styles/                  # Токены, базовые стили, компоненты и страницы
```

Дополнительная документация и чеклисты лежат в `docs/`, включая результаты диагностики и отчёт по исправлениям. 【F:docs/diagnostics/console-dump.md†L1-L23】【F:docs/fix-report.md†L1-L48】


## Тестирование и качество
- ESLint и Prettier обеспечивают единые правила оформления. 【F:package.json†L9-L32】
- Vitest покрывает модульную логику, Playwright — базовые пользовательские сценарии (`tests/e2e/app-shell.spec.ts`). 【F:tests/e2e/app-shell.spec.ts†L1-L120】
- TypeScript и Zod снижают риск регрессий за счёт строгой типизации и схем валидации. 【F:src/features/reports/ReportsBuilderCanvas.tsx†L1-L90】

## Последние обновления интерфейса
- Добавлен скролл внутри модальных окон и ограничение высоты контента, чтобы не блокировать доступ к фону и действиям. 【F:src/styles/components/_modal.css†L37-L81】
- Конструктор плейбуков получил поле для токена Ollama и мини-чат с ассистентом, который готовит подсказки по сценариям. 【F:src/features/automation/PlaybookBuilder.tsx†L65-L293】

